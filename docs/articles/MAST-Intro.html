<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAST Intro • MAST</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="MAST Intro">
<meta property="og:description" content="MAST">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MAST</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.21.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/MAITAnalysis.html">Using MAST with RNASeq: MAIT Analysis.</a>
    </li>
    <li>
      <a href="../articles/MAST-Intro.html">MAST Intro</a>
    </li>
    <li>
      <a href="../articles/MAST-interoperability.html">Interoptability between MAST and SingleCellExperiment-derived packages.</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/RGLab/MAST/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="MAST-Intro_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>MAST Intro</h1>
                        <h4 data-toc-skip class="author">Andrew McDavid</h4>
                        <h4 data-toc-skip class="author">Greg Finak</h4>
            
            <h4 data-toc-skip class="date">8/23/2017</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/RGLab/MAST/blob/HEAD/vignettes/MAST-Intro.Rmd" class="external-link"><code>vignettes/MAST-Intro.Rmd</code></a></small>
      <div class="hidden name"><code>MAST-Intro.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="philosophy">Philosophy<a class="anchor" aria-label="anchor" href="#philosophy"></a>
</h2>
<p>MAST is an R/Bioconductor package for managing and analyzing qPCR and sequencing-based single-cell gene expression data, as well as data from other types of single-cell assays. Our goal is to support assays that have multiple <em>features</em> (genes, markers, etc) per <em>well</em> (cell, etc) in a flexible manner. Assays are assumed to be mostly <em>complete</em> in the sense that most <em>wells</em> contain measurements for all features.</p>
<div class="section level3">
<h3 id="internals">Internals<a class="anchor" aria-label="anchor" href="#internals"></a>
</h3>
<p>A <code>SingleCellAssay</code> object can be manipulated as a matrix, with rows giving features and columns giving cells. It derives from <a href="%60SingleCellExperiment%60">http://bioconductor.org/packages/release/bioc/html/SingleCellExperiment.html</a>.</p>
</div>
<div class="section level3">
<h3 id="statistical-testing">Statistical Testing<a class="anchor" aria-label="anchor" href="#statistical-testing"></a>
</h3>
<p>Apart from reading and storing single-cell assay data, the package also provides functionality for significance testing of differential expression using a Hurdle model, gene set enrichment, facilities for visualizing patterns in residuals indicative of differential expression, and more.</p>
<p>There is also some facilities for inferring background thresholds, and filtering of individual outlier wells/libraries. These methods are described our papers, <span class="citation">McDavid et al. (2014)</span> , <span class="citation">McDavid et al. (2013)</span> , <span class="citation">Finak et al. (2015)</span> , <span class="citation">McDavid, Finak, and Gottardo (2016)</span> .</p>
</div>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<p>With the cursory background out of the way, we’ll proceed with some examples to help understand how the package is used.</p>
<div class="section level3">
<h3 id="reading-data">Reading Data<a class="anchor" aria-label="anchor" href="#reading-data"></a>
</h3>
<p>Data can be imported in a Fluidigm instrument-specific format (the details of which are undocumented, and likely subject-to-change) or some derived, annotated format, or in “long” (melted) format, in which each row is a measurement, so if there are <span class="math inline">\(N\)</span> wells and <span class="math inline">\(M\)</span> cells, then the <code>data.frame</code> should contain <span class="math inline">\(N \times M\)</span> rows.</p>
<p>For example, the following data set was provided in as a comma-separated value file. It has the cycle threshold (<span class="math inline">\(ct\)</span>) recorded. Non-detected genes are recorded as NAs. For the Fluidigm/qPCR single cell expression functions to work as expected, we must use the <em>expression threshold</em>, defined as <span class="math inline">\(et = c_{\mbox{max}} - ct\)</span>, which is proportional to the log-expression.</p>
<p>Below, we load the package and the data, then compute the expression threshold from the <span class="math inline">\(ct\)</span>, and construct a <code>FluidigmAssay</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">vbeta</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">vbeta</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##  [1] "Sample.ID"         "Subject.ID"        "Experiment.Number"</span>
<span class="co">##  [4] "Chip.Number"       "Stim.Condition"    "Time"             </span>
<span class="co">##  [7] "Population"        "Number.of.Cells"   "Well"             </span>
<span class="co">## [10] "Gene"              "Ct"</span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vbeta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computeEtFromCt.html">computeEtFromCt</a></span><span class="op">(</span><span class="va">vbeta</span><span class="op">)</span>
<span class="va">vbeta.fa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FromFlatDF.html">FromFlatDF</a></span><span class="op">(</span><span class="va">vbeta</span>, idvars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Subject.ID"</span>, <span class="st">"Chip.Number"</span>, <span class="st">"Well"</span><span class="op">)</span>,
                          primerid<span class="op">=</span><span class="st">'Gene'</span>, measurement<span class="op">=</span><span class="st">'Et'</span>, ncells<span class="op">=</span><span class="st">'Number.of.Cells'</span>,
                          geneid<span class="op">=</span><span class="st">"Gene"</span>,  cellvars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Number.of.Cells'</span>, <span class="st">'Population'</span><span class="op">)</span>,
                          phenovars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Stim.Condition'</span>,<span class="st">'Time'</span><span class="op">)</span>, id<span class="op">=</span><span class="st">'vbeta all'</span>, class<span class="op">=</span><span class="st">'FluidigmAssay'</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## No dimnames in `exprsArray`, assuming `fData` and `cData` are sorted according to `exprsArray`</span></code></pre>
<pre><code><span class="co">## Assuming data assay in position 1, with name Et is log-transformed.</span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">vbeta.fa</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## class: FluidigmAssay </span>
<span class="co">## dim: 75 456 </span>
<span class="co">## metadata(0):</span>
<span class="co">## assays(1): Et</span>
<span class="co">## rownames(75): B3GAT1 BAX ... TNFRSF9 TNFSF10</span>
<span class="co">## rowData names(2): Gene primerid</span>
<span class="co">## colnames(456): Sub01 1 A01 Sub01 1 A02 ... Sub02 3 H10 Sub02 3 H11</span>
<span class="co">## colData names(9): Number.of.Cells Population ... Time wellKey</span>
<span class="co">## reducedDimNames(0):</span>
<span class="co">## mainExpName: NULL</span>
<span class="co">## altExpNames(0):</span></code></pre>
<p>We see that the variable <code>vbeta</code> is a <code>data.frame</code> from which we construct the <code>FluidigmAssay</code> object. The <code>idvars</code> is the set of column(s) in <code>vbeta</code> that uniquely identify a well (globally), the <code>primerid</code> is a column(s) that specify the feature measured at this well. The <code>measurement</code> gives the column name containing the log-expression measurement, <code>ncells</code> contains the number of cells (or other normalizing factor) for the well. <code>geneid</code>, <code>cellvars</code>, <code>phenovars</code> all specify additional columns to be included in the <code>rowData</code>, and <code>colData</code>. The output is a <code>FluidigmAssay</code> object with  wells and  features.</p>
<p>We can access the feature-level metadata and the cell-level metadata using the <code>rowData</code> and <code>colData</code> accessors.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">rowData</span><span class="op">(</span><span class="va">vbeta.fa</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## DataFrame with 3 rows and 2 columns</span>
<span class="co">##               Gene    primerid</span>
<span class="co">##        &lt;character&gt; &lt;character&gt;</span>
<span class="co">## B3GAT1      B3GAT1      B3GAT1</span>
<span class="co">## BAX            BAX         BAX</span>
<span class="co">## BCL2          BCL2        BCL2</span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">vbeta.fa</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## DataFrame with 3 rows and 9 columns</span>
<span class="co">##             Number.of.Cells            Population    ncells Subject.ID</span>
<span class="co">##                   &lt;integer&gt;           &lt;character&gt; &lt;integer&gt;   &lt;factor&gt;</span>
<span class="co">## Sub01 1 A01               1 CD154+VbetaResponsive         1      Sub01</span>
<span class="co">## Sub01 1 A02               1 CD154+VbetaResponsive         1      Sub01</span>
<span class="co">## Sub01 1 A03               1 CD154+VbetaResponsive         1      Sub01</span>
<span class="co">##             Chip.Number        Well Stim.Condition     Time     wellKey</span>
<span class="co">##               &lt;integer&gt; &lt;character&gt;    &lt;character&gt; &lt;factor&gt; &lt;character&gt;</span>
<span class="co">## Sub01 1 A01           1         A01      Stim(SEB)       12 Sub01 1 A01</span>
<span class="co">## Sub01 1 A02           1         A02      Stim(SEB)       12 Sub01 1 A02</span>
<span class="co">## Sub01 1 A03           1         A03      Stim(SEB)       12 Sub01 1 A03</span></code></pre>
We see this gives us the set of genes measured in the assay, or the cell-level metadata (i.e. the number of cells measured in the well, the population this cell belongs to, the subject it came from, the chip it was run on, the well id, the stimulation it was subjected to, and the timepoint for the experiment this cell was part of). The wellKey are concatenated idvars columns, helping to ensure consistency when splitting and merging SCA objects.
<p>Data can also be imported in matrix format using command <code>FromMatrix</code>, and passing a matrix of expression values and <code>DataFrame</code> coercible cell and feature data.</p>
<p>It’s possible to subset SingleCellAssay objects by wells and features. Square brackets (“[”) will index on the first index (features) and by features on the second index (cells). Integer and boolean and indices may be used, as well as character vectors naming the wellKey or the feature (via the primerid). There is also a <code>subset</code> method, which will evaluate its argument in the frame of the <code>colData</code>, hence will subset by wells.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sub1</span> <span class="op">&lt;-</span> <span class="va">vbeta.fa</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/methods/show.html" class="external-link">show</a></span><span class="op">(</span><span class="va">sub1</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## class: FluidigmAssay </span>
<span class="co">## dim: 75 10 </span>
<span class="co">## metadata(0):</span>
<span class="co">## assays(1): Et</span>
<span class="co">## rownames(75): B3GAT1 BAX ... TNFRSF9 TNFSF10</span>
<span class="co">## rowData names(2): Gene primerid</span>
<span class="co">## colnames(10): Sub01 1 A01 Sub01 1 A02 ... Sub01 1 A09 Sub01 1 A10</span>
<span class="co">## colData names(9): Number.of.Cells Population ... Time wellKey</span>
<span class="co">## reducedDimNames(0):</span>
<span class="co">## mainExpName: NULL</span>
<span class="co">## altExpNames(0):</span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sub2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/subset.data.table.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">vbeta.fa</span>, <span class="va">Well</span><span class="op">==</span><span class="st">'A01'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/methods/show.html" class="external-link">show</a></span><span class="op">(</span><span class="va">sub2</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## class: FluidigmAssay </span>
<span class="co">## dim: 75 5 </span>
<span class="co">## metadata(0):</span>
<span class="co">## assays(1): Et</span>
<span class="co">## rownames(75): B3GAT1 BAX ... TNFRSF9 TNFSF10</span>
<span class="co">## rowData names(2): Gene primerid</span>
<span class="co">## colnames(5): Sub01 1 A01 Sub01 2 A01 Sub02 1 A01 Sub02 2 A01 Sub02 3</span>
<span class="co">##   A01</span>
<span class="co">## colData names(9): Number.of.Cells Population ... Time wellKey</span>
<span class="co">## reducedDimNames(0):</span>
<span class="co">## mainExpName: NULL</span>
<span class="co">## altExpNames(0):</span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sub3</span> <span class="op">&lt;-</span> <span class="va">vbeta.fa</span><span class="op">[</span><span class="fl">6</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/methods/show.html" class="external-link">show</a></span><span class="op">(</span><span class="va">sub3</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## class: FluidigmAssay </span>
<span class="co">## dim: 5 10 </span>
<span class="co">## metadata(0):</span>
<span class="co">## assays(1): Et</span>
<span class="co">## rownames(5): CCL4 CCL5 CCR2 CCR4 CCR5</span>
<span class="co">## rowData names(2): Gene primerid</span>
<span class="co">## colnames(10): Sub01 1 A01 Sub01 1 A02 ... Sub01 1 A09 Sub01 1 A10</span>
<span class="co">## colData names(9): Number.of.Cells Population ... Time wellKey</span>
<span class="co">## reducedDimNames(0):</span>
<span class="co">## mainExpName: NULL</span>
<span class="co">## altExpNames(0):</span></code></pre>
<p>The colData and rowData <code>DataFrame</code>s are subset accordingly as well.</p>
<p>A SingleCellAssay may be split into a list of SingleCellAssay. The split method takes an argument which names the column (factor) on which to split the data. Each level of the factor will be placed in its own SingleCellAssay within the list.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">vbeta.fa</span>, <span class="st">'Subject.ID'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/methods/show.html" class="external-link">show</a></span><span class="op">(</span><span class="va">sp1</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $Sub01</span>
<span class="co">## class: FluidigmAssay </span>
<span class="co">## dim: 75 177 </span>
<span class="co">## metadata(0):</span>
<span class="co">## assays(1): Et</span>
<span class="co">## rownames(75): B3GAT1 BAX ... TNFRSF9 TNFSF10</span>
<span class="co">## rowData names(2): Gene primerid</span>
<span class="co">## colnames(177): Sub01 1 A01 Sub01 1 A02 ... Sub01 2 H09 Sub01 2 H10</span>
<span class="co">## colData names(9): Number.of.Cells Population ... Time wellKey</span>
<span class="co">## reducedDimNames(0):</span>
<span class="co">## mainExpName: NULL</span>
<span class="co">## altExpNames(0):</span>
<span class="co">## </span>
<span class="co">## $Sub02</span>
<span class="co">## class: FluidigmAssay </span>
<span class="co">## dim: 75 279 </span>
<span class="co">## metadata(0):</span>
<span class="co">## assays(1): Et</span>
<span class="co">## rownames(75): B3GAT1 BAX ... TNFRSF9 TNFSF10</span>
<span class="co">## rowData names(2): Gene primerid</span>
<span class="co">## colnames(279): Sub02 1 A01 Sub02 1 A02 ... Sub02 3 H10 Sub02 3 H11</span>
<span class="co">## colData names(9): Number.of.Cells Population ... Time wellKey</span>
<span class="co">## reducedDimNames(0):</span>
<span class="co">## mainExpName: NULL</span>
<span class="co">## altExpNames(0):</span></code></pre>
<p>The splitting variable can either be a character vector naming column(s) of the SingleCellAssay, or may be a <code>factor</code> or <code>list</code> of <code>factor</code>s.</p>
<p>It’s possible to combine SingleCellAssay objects with the <code>cbind</code> method.</p>
<pre><code><span class="co">## class: FluidigmAssay </span>
<span class="co">## dim: 75 456 </span>
<span class="co">## metadata(0):</span>
<span class="co">## assays(1): Et</span>
<span class="co">## rownames(75): B3GAT1 BAX ... TNFRSF9 TNFSF10</span>
<span class="co">## rowData names(2): Gene primerid</span>
<span class="co">## colnames(456): Sub01 1 A01 Sub01 1 A02 ... Sub02 3 H10 Sub02 3 H11</span>
<span class="co">## colData names(9): Number.of.Cells Population ... Time wellKey</span>
<span class="co">## reducedDimNames(0):</span>
<span class="co">## mainExpName: NULL</span>
<span class="co">## altExpNames(0):</span></code></pre>
</div>
<div class="section level3">
<h3 id="filtering">Filtering<a class="anchor" aria-label="anchor" href="#filtering"></a>
</h3>
<p>We can filter and perform some significance tests on the SingleCellAssay. We may want to filter any wells with at least two outlier cells where the discrete and continuous parts of the signal are at least 9 standard deviations from the mean. This is a very conservative filtering criteria. We’ll group the filtering by the number of cells.</p>
<p>We’ll split the assay by the number of cells and look at the concordance plot after filtering.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vbeta.split</span><span class="op">&lt;-</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">vbeta.fa</span>,<span class="st">"Number.of.Cells"</span><span class="op">)</span>
<span class="co">#see default parameters for plotSCAConcordance</span>
<span class="fu"><a href="../reference/plotSCAConcordance.html">plotSCAConcordance</a></span><span class="op">(</span><span class="va">vbeta.split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,<span class="va">vbeta.split</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,
                   filterCriteria<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nOutlier <span class="op">=</span> <span class="fl">1</span>, sigmaContinuous <span class="op">=</span> <span class="fl">9</span>,
                       sigmaProportion <span class="op">=</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Using primerid as id variables</span>
<span class="co">## Using primerid as id variables</span>
<span class="co">## Using primerid as id variables</span>
<span class="co">## Using primerid as id variables</span></code></pre>
<pre><code><span class="co">## Sum of Squares before Filtering: 14.89</span>
<span class="co">##  After filtering: 12.41</span>
<span class="co">##  Difference: 2.48</span></code></pre>
<p><img src="MAST-Intro_files/figure-html/splitbyncells-1.png" width="384"></p>
<p>The filtering function has several other options, including whether the filter shuld be applied (thus returning a new SingleCellAssay object) or returned as a matrix of boolean values.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vbeta.fa</span></code></pre></div>
<pre><code><span class="co">## class: FluidigmAssay </span>
<span class="co">## dim: 75 456 </span>
<span class="co">## metadata(0):</span>
<span class="co">## assays(1): Et</span>
<span class="co">## rownames(75): B3GAT1 BAX ... TNFRSF9 TNFSF10</span>
<span class="co">## rowData names(2): Gene primerid</span>
<span class="co">## colnames(456): Sub01 1 A01 Sub01 1 A02 ... Sub02 3 H10 Sub02 3 H11</span>
<span class="co">## colData names(9): Number.of.Cells Population ... Time wellKey</span>
<span class="co">## reducedDimNames(0):</span>
<span class="co">## mainExpName: NULL</span>
<span class="co">## altExpNames(0):</span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Split by 'ncells', apply to each component, then recombine</span>
<span class="va">vbeta.filtered</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mast_filter.html">mast_filter</a></span><span class="op">(</span><span class="va">vbeta.fa</span>, groups<span class="op">=</span><span class="st">'ncells'</span><span class="op">)</span>
<span class="co">## Returned as boolean matrix</span>
<span class="va">was.filtered</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mast_filter.html">mast_filter</a></span><span class="op">(</span><span class="va">vbeta.fa</span>, apply_filter<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="co">## Wells filtered for being discrete outliers</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/subset.data.table.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">was.filtered</span>, <span class="va">pctout</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##             intout null pctout</span>
<span class="co">## Sub01 1 D05  FALSE TRUE   TRUE</span>
<span class="co">## Sub01 1 D06  FALSE TRUE   TRUE</span>
<span class="co">## Sub01 1 D07  FALSE TRUE   TRUE</span>
<span class="co">## Sub01 1 D08  FALSE TRUE   TRUE</span>
<span class="co">## Sub01 1 D10  FALSE TRUE   TRUE</span>
<span class="co">## Sub01 1 D11  FALSE TRUE   TRUE</span></code></pre>
<p>There’s also some functionality for visualizing the filtering.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/mast_filter.html">burdenOfFiltering</a></span><span class="op">(</span><span class="va">vbeta.fa</span>, <span class="st">'ncells'</span>, byGroup<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="MAST-Intro_files/figure-html/burdenOfFiltering-1.png" width="384"></p>
</div>
</div>
<div class="section level2">
<h2 id="significance-testing-under-the-hurdle-model">Significance testing under the Hurdle model<a class="anchor" aria-label="anchor" href="#significance-testing-under-the-hurdle-model"></a>
</h2>
<p>There are two frameworks available in the package. The first framework <code>zlm</code> offers a full linear model to allow arbitrary comparisons and adjustment for covariates. The second framework <code>LRT</code> can be considered essentially performing t-tests (respecting the discrete/continuous nature of the data) between pairs of groups. <code>LRT</code> is subsumed by the first framework, but might be simpler for some users, so has been kept in the package.</p>
<p>We’ll describe <code>zlm</code>. Models are specified in terms of the variable used as the measure and covariates present in the <code>colData</code> using symbolic notation, just as the <code>lm</code> function in R.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vbeta.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/subset.data.table.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">vbeta.fa</span>, <span class="va">ncells</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span>
<span class="co">## Consider the first 20 genes</span>
<span class="va">vbeta.1</span> <span class="op">&lt;-</span> <span class="va">vbeta.1</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>,<span class="op">]</span> 
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">vbeta.1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## DataFrame with 6 rows and 9 columns</span>
<span class="co">##             Number.of.Cells            Population    ncells Subject.ID</span>
<span class="co">##                   &lt;integer&gt;           &lt;character&gt; &lt;integer&gt;   &lt;factor&gt;</span>
<span class="co">## Sub01 1 A01               1 CD154+VbetaResponsive         1      Sub01</span>
<span class="co">## Sub01 1 A02               1 CD154+VbetaResponsive         1      Sub01</span>
<span class="co">## Sub01 1 A03               1 CD154+VbetaResponsive         1      Sub01</span>
<span class="co">## Sub01 1 A04               1 CD154+VbetaResponsive         1      Sub01</span>
<span class="co">## Sub01 1 A05               1 CD154+VbetaResponsive         1      Sub01</span>
<span class="co">## Sub01 1 A06               1 CD154+VbetaResponsive         1      Sub01</span>
<span class="co">##             Chip.Number        Well Stim.Condition     Time     wellKey</span>
<span class="co">##               &lt;integer&gt; &lt;character&gt;    &lt;character&gt; &lt;factor&gt; &lt;character&gt;</span>
<span class="co">## Sub01 1 A01           1         A01      Stim(SEB)       12 Sub01 1 A01</span>
<span class="co">## Sub01 1 A02           1         A02      Stim(SEB)       12 Sub01 1 A02</span>
<span class="co">## Sub01 1 A03           1         A03      Stim(SEB)       12 Sub01 1 A03</span>
<span class="co">## Sub01 1 A04           1         A04      Stim(SEB)       12 Sub01 1 A04</span>
<span class="co">## Sub01 1 A05           1         A05      Stim(SEB)       12 Sub01 1 A05</span>
<span class="co">## Sub01 1 A06           1         A06      Stim(SEB)       12 Sub01 1 A06</span></code></pre>
<p>Now, for each gene, we can regress on <code>Et</code> the factors <code>Population</code> and <code>Subject.ID</code>.</p>
<p>In each gene, we’ll fit a Hurdle model with a separate intercept for each population and subject. A an S4 object of class “ZlmFit” is returned, containing slots with the genewise coefficients, variance-covariance matrices, etc.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="va">zlm.output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/zlm.html">zlm</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Population</span> <span class="op">+</span> <span class="va">Subject.ID</span>, <span class="va">vbeta.1</span>,<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/methods/show.html" class="external-link">show</a></span><span class="op">(</span><span class="va">zlm.output</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Fitted zlm on 20 genes and 413 cells.</span>
<span class="co">##  Using BayesGLMlike ~ Population + Subject.ID</span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## returns a data.table with a summary of the fit</span>
<span class="va">coefAndCI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/NMF/man/assess.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">zlm.output</span>, logFC<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">datatable</span>
<span class="va">coefAndCI</span> <span class="op">&lt;-</span> <span class="va">coefAndCI</span><span class="op">[</span><span class="va">contrast</span> <span class="op">!=</span> <span class="st">'(Intercept)'</span>,<span class="op">]</span>
<span class="va">coefAndCI</span><span class="op">[</span>,<span class="va">contrast</span><span class="op">:=</span><span class="fu"><a href="https://rdrr.io/r/base/abbreviate.html" class="external-link">abbreviate</a></span><span class="op">(</span><span class="va">contrast</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">coefAndCI</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">contrast</span>, y<span class="op">=</span><span class="va">coef</span>, ymin<span class="op">=</span><span class="va">ci.lo</span>, ymax<span class="op">=</span><span class="va">ci.hi</span>, col<span class="op">=</span><span class="va">component</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_pointrange</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">primerid</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle<span class="op">=</span><span class="fl">45</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="MAST-Intro_files/figure-html/zlmExample-1.png" width="576"></p>
<p>Try <code>?ZlmFit-class</code> or <code>showMethods(classes='ZlmFit')</code> to see a full list of methods. Multicore support is offered by setting <code>options(mc.cores=4)</code>, or however many cores your system has.</p>
<p>The combined test for differences in proportion expression/average expression is found by calling a likelihood ratio test on the fitted object. An array of genes, metrics and test types is returned. We’ll plot the -log10 P values by gene and test type.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">zlm.lr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lrTest.html">lrTest</a></span><span class="op">(</span><span class="va">zlm.output</span>, <span class="st">'Population'</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Refitting on reduced model...</span></code></pre>
<pre><code><span class="co">## </span>
<span class="co">## Done!</span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/class.eSet.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">zlm.lr</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $primerid</span>
<span class="co">##  [1] "B3GAT1" "BAX"    "BCL2"   "CCL2"   "CCL3"   "CCL4"   "CCL5"   "CCR2"  </span>
<span class="co">##  [9] "CCR4"   "CCR5"   "CCR7"   "CD109"  "CD27"   "CD28"   "CD38"   "CD3d"  </span>
<span class="co">## [17] "CD3g"   "CD4"    "CD40LG" "CD45"  </span>
<span class="co">## </span>
<span class="co">## $test.type</span>
<span class="co">## [1] "cont"   "disc"   "hurdle"</span>
<span class="co">## </span>
<span class="co">## $metric</span>
<span class="co">## [1] "lambda"     "df"         "Pr(&gt;Chisq)"</span></code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">zlm.lr</span><span class="op">[</span>,,<span class="st">'Pr(&gt;Chisq)'</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">primerid</span>, y<span class="op">=</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">'identity'</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">test.type</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning in melt(zlm.lr[, , "Pr(&gt;Chisq)"]): The melt generic in data.table has</span>
<span class="co">## been passed a matrix and will attempt to redirect to the relevant reshape2</span>
<span class="co">## method; please note that reshape2 is deprecated, and this redirection is now</span>
<span class="co">## deprecated as well. To continue using melt methods from reshape2 while both</span>
<span class="co">## libraries are attached, e.g. melt.list, you can prepend the namespace like</span>
<span class="co">## reshape2::melt(zlm.lr[, , "Pr(&gt;Chisq)"]). In the next version, this warning will</span>
<span class="co">## become an error.</span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pvalue</span><span class="op">)</span></code></pre></div>
<p><img src="MAST-Intro_files/figure-html/tests-1.png" width="384"></p>
<p>In fact, the <code>zlm</code> framework is quite general, and has wrappers for a variety of modeling functions that accept <code>glm</code>-like arguments to be used, such as mixed models (using <code>lme4</code>). <!-- %This is not eval'd because of mysterious errors emanating from lme4 on the bioconductor machines that I am unable to reproduce. --> <!-- % Warning: failed to assign RegisteredNativeSymbol for deepcopy to deepcopy since deepcopy is already defined in the 'lme4' namespace --> <!-- % Quitting from lines 230-232 (MAST-intro.Rnw)  --> <!-- % Error: processing vignette 'MAST-intro.Rnw' failed with diagnostics: --> <!-- % first argument must be a string (of length 1) or native symbol reference --> <!-- % Execution halted --></p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/" class="external-link">lme4</a></span><span class="op">)</span>
<span class="va">lmer.output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/zlm.html">zlm</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Stim.Condition</span> <span class="op">+</span><span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">Subject.ID</span><span class="op">)</span>, <span class="va">vbeta.1</span>, method<span class="op">=</span><span class="st">'glmer'</span>, ebayes<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>By default, we employ Bayesian logistic regression, which imposes a Cauchy prior of the regression coefficients, for the discrete component. This provides reasonable inference under linear separation. We default to regular least squares for the continuous component with an empirical Bayes’ adjustment for the dispersion (variance) estimate. However, the prior can be adjusted (see <code>defaultPrior</code>) or eliminated entirely by setting <code>method='glm'</code> in <code>zlm</code>. It is also possible to use Bayesian linear regression for the continuous component by setting <code>useContinuousBayes=TRUE</code> in <code>zlm</code>. For example:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="va">orig_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/zlm.html">zlm</a></span><span class="op">(</span><span class="op">~</span><span class="va">Stim.Condition</span>, <span class="va">vbeta.1</span><span class="op">)</span>
 <span class="va">dp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defaultPrior.html">defaultPrior</a></span><span class="op">(</span><span class="st">'Stim.ConditionUnstim'</span><span class="op">)</span>
 <span class="va">new_results</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/zlm.html">zlm</a></span><span class="op">(</span><span class="op">~</span><span class="va">Stim.Condition</span>, <span class="va">vbeta.1</span>, useContinuousBayes<span class="op">=</span><span class="cn">TRUE</span>,coefPrior<span class="op">=</span><span class="va">dp</span><span class="op">)</span>
 <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/qplot.html" class="external-link">qplot</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">orig_results</span>, <span class="st">'C'</span><span class="op">)</span><span class="op">[</span>, <span class="st">'Stim.ConditionUnstim'</span><span class="op">]</span>,
       y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">new_results</span>, <span class="st">'C'</span><span class="op">)</span><span class="op">[</span>, <span class="st">'Stim.ConditionUnstim'</span><span class="op">]</span>,
       color<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">new_results</span>, <span class="st">'D'</span><span class="op">)</span><span class="op">[</span>,<span class="st">'(Intercept)'</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span>
     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">'Default prior'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">'Informative Prior'</span><span class="op">)</span> <span class="op">+</span>
     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope<span class="op">=</span><span class="fl">1</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_continuous.html" class="external-link">scale_color_continuous</a></span><span class="op">(</span><span class="st">'Baseline\nlog odds\nof expression'</span><span class="op">)</span></code></pre></div>
<p><img src="MAST-Intro_files/figure-html/advancedArmExample-1.png" width="384"></p>
<p>After applying a prior to the continuous component, its estimates are shrunken towards zero, with the amount of shrinkage inversely depending on the number of expressing cells in the gene.</p>
<div class="section level3">
<h3 id="two-sample-likelihood-ratio-test">Two-sample Likelihood Ratio Test<a class="anchor" aria-label="anchor" href="#two-sample-likelihood-ratio-test"></a>
</h3>
<p>Another way to test for differential expression is available through the <code>LRT</code> function, which is analogous to two-sample T tests.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">two.sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/LRT.html">LRT</a></span><span class="op">(</span><span class="va">vbeta.1</span>, <span class="st">'Population'</span>, referent<span class="op">=</span><span class="st">'CD154+VbetaResponsive'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">two.sample</span><span class="op">)</span> </code></pre></div>
<pre><code><span class="co">##              Population test.type primerid    lrstat direction   p.value</span>
<span class="co">## 1 CD154-VbetaResponsive      comb   B3GAT1 1.5722257        -1 0.4556124</span>
<span class="co">## 2 CD154-VbetaResponsive      comb      BAX 1.5847859         1 0.4527601</span>
<span class="co">## 3 CD154-VbetaResponsive      comb     BCL2 0.7821003        -1 0.6763462</span>
<span class="co">## 4 CD154-VbetaResponsive      comb     CCL2 3.3431031        -1 0.1879552</span>
<span class="co">## 5 CD154-VbetaResponsive      comb     CCL3 0.1401862        -1 0.9323070</span>
<span class="co">## 6 CD154-VbetaResponsive      comb     CCL4 0.6305951         1 0.7295718</span></code></pre>
<p>Here we compare each population (<strong>CD154-VbetaResponsive, CD154-VbetaUnresponsive CD154+VbetaUnresponsive, VbetaResponsive, VbetaUnresponsive</strong>) to the <strong>CD154+VbetaResponsive</strong> population. The <code>Population</code> column shows which population is being compared, while <code>test.type</code> is <code>comb</code> for the combined normal theory/binomial test. Column <code>primerid</code> gives the gene being tested, <code>direction</code> shows if the comparison group mean is greater (1) or less (-1) than the referent group, and <code>lrtstat</code> and <code>p.value</code> give the test statistic and <span class="math inline">\(\chi^2\)</span> p-value (two degrees of freedom). Other options are whether additional information about the tests are returned (<code>returnall=TRUE</code>) and if the testing should be stratified by a character vector naming columns in <code>colData</code> containing grouping variables (<code>groups</code>).</p>
<p>These tests have been subsumed by <code>zlm</code> but remain in the package for user convenience.</p>
</div>
</div>
<div class="section level2">
<h2 id="use-with-single-cell-rna-sequencing-data">Use with single cell RNA-sequencing data<a class="anchor" aria-label="anchor" href="#use-with-single-cell-rna-sequencing-data"></a>
</h2>
<p>In RNA-sequencing data is essentially no different than qPCR-based single cell gene expression, once it has been aligned and mapped, if one is willing to reduce the experiment to counts or count-like data for a fixed set of genes/features.<br>
We assume that suitable tools (eg, RSEM, Kallisto or TopHat) have been applied to do this.</p>
<p>An example of this use is provided in a vignette. Type <code><a href="../articles/MAITAnalysis.html">vignette('MAITAnalysis')</a></code> to view.</p>
<div class="section level4">
<h4 id="a-comment-on-implementation-details">A Comment on Implementation Details<a class="anchor" aria-label="anchor" href="#a-comment-on-implementation-details"></a>
</h4>
<p>Here we provide some background on the implementation of the package.</p>
<p>We derive from <code>SingleCellExperiment</code>, which is provides an array-like object to store tabular data that might have multiple derived representations. On construction of a <code>SingleCellAssay</code> object with <code>FromFlatDF</code>, the package tests for completeness, and will fill in the missing data (with NA) if it is not. The <code>FromMatrix</code> and <code>SceToSingleCellAssay</code> constructors do not do anything special for missing values, though these are not typically expected in scRNAseq data.</p>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references hanging-indent">
<div id="ref-Finak2015-uz">
<p>Finak, Greg, Andrew McDavid, Masanao Yajima, Jingyuan Deng, Vivian Gersuk, Alex K Shalek, Chloe K Slichter, et al. 2015. “MAST: A Flexible Statistical Framework for Assessing Transcriptional Changes and Characterizing Heterogeneity in Single-Cell RNA Sequencing Data.” <em>Genome Biol.</em> 16 (1): 1–13.</p>
</div>
<div id="ref-McDavid2014-kr">
<p>McDavid, Andrew, Lucas Dennis, Patrick Danaher, Greg Finak, Michael Krouse, Alice Wang, Philippa Webster, Joseph Beechem, and Raphael Gottardo. 2014. “Modeling Bi-Modality Improves Characterization of Cell Cycle on Gene Expression in Single Cells.” Edited by Sheng Zhong. <em>PLoS Comput. Biol.</em> 10 (7): e1003696.</p>
</div>
<div id="ref-McDavid2013-mc">
<p>McDavid, Andrew, Greg Finak, Pratip K Chattopadyay, Maria Dominguez, Laurie Lamoreaux, Steven S Ma, Mario Roederer, and Raphael Gottardo. 2013. “Data Exploration, Quality Control and Testing in Single-Cell qPCR-based Gene Expression Experiments.” <em>Bioinformatics</em> 29 (4): 461–67.</p>
</div>
<div id="ref-McDavid2016-rm">
<p>McDavid, Andrew, Greg Finak, and Raphael Gottardo. 2016. “The Contribution of Cell Cycle to Heterogeneity in Single-Cell RNA-seq Data.” <em>Nat. Biotechnol.</em> 34 (6): 591–93.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Andrew McDavid, Greg Finak, Masanao Yajima.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>

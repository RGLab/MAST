<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Threshold a count matrix using an adaptive threshold. — thresholdSCRNACountMatrix • MAST</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Threshold a count matrix using an adaptive threshold. — thresholdSCRNACountMatrix"><meta property="og:description" content="An adaptive threshold is calculated from the conditional mean of expression, based on 10 bins
of the genes with similar expression levels. Thresholds are chosen by estimating cutpoints in the bimodal density estimates of the
binned data.
These density estimates currently exclude the zeros due to complications with how the bandwidth is selected.
(If the bandwith is too small, then extra peaks/modes are found and everything goes haywire).
If the diagnostic plots don't reveal any bimodal bins, this is probably the reason, and you may not need to threshold since background in the data are exact zeros."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MAST</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.21.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/MAITAnalysis.html">Using MAST with RNASeq: MAIT Analysis.</a>
    </li>
    <li>
      <a href="../articles/MAST-Intro.html">MAST Intro</a>
    </li>
    <li>
      <a href="../articles/MAST-interoperability.html">Interoptability between MAST and SingleCellExperiment-derived packages.</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/RGLab/MAST/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Threshold a count matrix using an adaptive threshold.</h1>
    <small class="dont-index">Source: <a href="https://github.com/RGLab/MAST/blob/HEAD/R/thresholdSCRNA.R" class="external-link"><code>R/thresholdSCRNA.R</code></a></small>
    <div class="hidden name"><code>thresholdSCRNACountMatrix.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>An adaptive threshold is calculated from the conditional mean of expression, based on 10 bins
of the genes with similar expression levels. Thresholds are chosen by estimating cutpoints in the bimodal density estimates of the
binned data.
These density estimates currently exclude the zeros due to complications with how the bandwidth is selected.
(If the bandwith is too small, then extra peaks/modes are found and everything goes haywire).
If the diagnostic plots don't reveal any bimodal bins, this is probably the reason, and you may not need to threshold since background in the data are exact zeros.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">thresholdSCRNACountMatrix</span><span class="op">(</span>
  <span class="va">data_all</span>,
  conditions <span class="op">=</span> <span class="cn">NULL</span>,
  cutbins <span class="op">=</span> <span class="cn">NULL</span>,
  nbins <span class="op">=</span> <span class="fl">10</span>,
  bin_by <span class="op">=</span> <span class="st">"median"</span>,
  qt <span class="op">=</span> <span class="fl">0.975</span>,
  min_per_bin <span class="op">=</span> <span class="fl">50</span>,
  absolute_min <span class="op">=</span> <span class="fl">0</span>,
  data_log <span class="op">=</span> <span class="cn">TRUE</span>,
  adj <span class="op">=</span> <span class="fl">1</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>data_all</dt>
<dd><p><code>matrix</code> of (possibly log-transformed) counts or TPM.  Rows are genes and columns are cells.</p></dd>
<dt>conditions</dt>
<dd><p>Bins are be determined per gene and per condition.  Typically contrasts of interest should be specified.</p></dd>
<dt>cutbins</dt>
<dd><p><code>vector</code> of cut points.</p></dd>
<dt>nbins</dt>
<dd><p><code>integer</code> number of bins when cutbins is not specified.</p></dd>
<dt>bin_by</dt>
<dd><p><code>character</code> "median", "proportion", "mean"</p></dd>
<dt>qt</dt>
<dd><p>when <code>bin_by</code> is "quantile", what quantile should be used to form the bins</p></dd>
<dt>min_per_bin</dt>
<dd><p>minimum number of genes within a bin</p></dd>
<dt>absolute_min</dt>
<dd><p><code>numeric</code> giving a hard threshold below which everything is assumed to be noise</p></dd>
<dt>data_log</dt>
<dd><p>is <code>data_all</code> log+1 transformed?  If so, it will be returned on the (log+1)-scale as well.</p></dd>
<dt>adj</dt>
<dd><p>bandwith adjustment, passed to <code>density</code></p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p><code>list</code> of thresholded counts (on natural scale), thresholds, bins, densities estimated on each bin, and the original data</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">maits</span>,package<span class="op">=</span><span class="st">'MAST'</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="va">sca</span> <span class="op">&lt;-</span> <span class="fu"><a href="FromMatrix.html">FromMatrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">maits</span><span class="op">$</span><span class="va">expressionmat</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">1000</span><span class="op">]</span><span class="op">)</span>, <span class="va">maits</span><span class="op">$</span><span class="va">cdat</span>, <span class="va">maits</span><span class="op">$</span><span class="va">fdat</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000</span>,<span class="op">]</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Assuming data assay in position 1, with name et is log-transformed.</span>
<span class="r-in"><span class="va">tt</span> <span class="op">&lt;-</span> <span class="fu">thresholdSCRNACountMatrix</span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">sca</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (0.0426,0.354]  (0.354,0.757]   (0.757,1.28]    (1.28,1.96]    (1.96,2.84] </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       2.258200       2.258200       2.258200       2.258200       2.258200 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    (2.84,3.99]    (3.99,13.2] </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       2.258200       3.313588 </span>
<span class="r-in"><span class="va">tt</span> <span class="op">&lt;-</span> <span class="fu">thresholdSCRNACountMatrix</span><span class="op">(</span><span class="fl">2</span><span class="op">^</span><span class="fu">assay</span><span class="op">(</span><span class="va">sca</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>, data_log<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (0.0426,0.354]  (0.354,0.757]   (0.757,1.28]    (1.28,1.96]    (1.96,2.84] </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       2.258200       2.258200       2.258200       2.258200       2.258200 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    (2.84,3.99]    (3.99,13.2] </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       2.258200       3.313588 </span>
<span class="r-in"><span class="va">opar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>no.readonly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">opar</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tt</span><span class="op">)</span></span>
<span class="r-plt img"><img src="thresholdSCRNACountMatrix-1.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Andrew McDavid, Greg Finak, Masanao Yajima.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>


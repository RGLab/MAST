<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Calculate log-fold changes from hurdle model components — logFC • MAST</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate log-fold changes from hurdle model components — logFC"><meta property="og:description" content="Using the delta method, estimate the log-fold change from a state given by a vector contrast0 and the state(s) given by contrast1."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MAST</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.21.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/MAITAnalysis.html">Using MAST with RNASeq: MAIT Analysis.</a>
    </li>
    <li>
      <a href="../articles/MAST-Intro.html">MAST Intro</a>
    </li>
    <li>
      <a href="../articles/MAST-interoperability.html">Interoptability between MAST and SingleCellExperiment-derived packages.</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/RGLab/MAST/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate log-fold changes from hurdle model components</h1>
    <small class="dont-index">Source: <a href="https://github.com/RGLab/MAST/blob/HEAD/R/ZlmFit-logFC.R" class="external-link"><code>R/ZlmFit-logFC.R</code></a></small>
    <div class="hidden name"><code>logFC.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Using the delta method, estimate the log-fold change from a state given by a vector contrast0 and the state(s) given by contrast1.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">logFC</span><span class="op">(</span><span class="va">zlmfit</span>, <span class="va">contrast0</span>, <span class="va">contrast1</span><span class="op">)</span>

<span class="fu">getLogFC</span><span class="op">(</span><span class="va">zlmfit</span>, <span class="va">contrast0</span>, <span class="va">contrast1</span><span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>zlmfit</dt>
<dd><p>ZlmFit output</p></dd>
<dt>contrast0</dt>
<dd><p>vector of coefficients giving baseline contrast, or a <code><a href="Hypothesis.html">Hypothesis</a></code>.  If missing, then the '(Intercept)' is used as baseline.</p></dd>
<dt>contrast1</dt>
<dd><p>matrix of coefficients giving comparison contrasts, or a <code><a href="Hypothesis.html">Hypothesis</a></code>.  If missing, then all non-(Intercept) coefficients are compared.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>list of matrices `logFC` and `varLogFC`, giving the log-fold-changes for each contrast (columns) and genes (rows) and the estimated sampling variance thereof</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The log-fold change is defined as follows.  For each gene, let \(u(x)\) be the expected value of the continuous component, given a covariate x and the estimated coefficients <code>coefC</code>, ie, \(u(x)=\) <code>crossprod(x, coefC)</code>.
Likewise, Let \(v(x)=\) <code>1/(1+exp(-crossprod(coefD, x)))</code> be the expected value of the discrete component.
 The log fold change from contrast0 to contrast1 is defined as
$$u(contrast1)v(contrast1)-u(contrast0)v(contrast0).$$
Note that for this to be a log-fold change, then the regression for u must have been fit on the log scale.  This is returned in the matrix <code>logFC</code>.
An approximation of the variance of <code>logFC</code> (applying the delta method to  formula defined above) is provided in <code>varLogFC</code>.</p>
    </div>
    <div id="functions">
    <h2>Functions</h2>
    
<ul><li><p><code>getLogFC</code>: Return results as a perhaps friendlier <code>data.table</code></p></li>
</ul></div>
    <div id="caveats">
    <h2>Caveats</h2>
    

<p>1.  When <code>method='bayesglm'</code> (the default), it's no longer necessarily true that the log fold change from condition A to B will be the inverse of the log fold change from B to A if the models are fit separately.
This is due to the shrinkage in <code>bayesglm</code>.</p>
<p>2.  The log fold change can be small, but the Hurdle p-value small and significant when the sign of the discrete and continuous model components are discordant 
so that the marginal log fold change cancels out.
The large sample sizes present in many single cell experiments also means that there is substantial power to detect even small changes.</p>
<p>3.  When there is no expression in a gene for a coefficient that is non-zero in either <code>condition0</code>
or <code>condition1</code> we return <code>NA</code> because there is not any information
to estimate the continuous component.  Technically we might return plus or minus infinity,
but there is not a straightforward way to estimate a confidence interval in any case.
See <a href="https://support.bioconductor.org/p/99244/" class="external-link">https://support.bioconductor.org/p/99244/</a> for details</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><a href="Hypothesis.html">Hypothesis</a></p>
<p><a href="summary-ZlmFit-method.html">summary,ZlmFit-method</a></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">vbetaFA</span><span class="op">)</span></span>
<span class="r-in"><span class="va">zz</span> <span class="op">&lt;-</span> <span class="fu"><a href="zlm.html">zlm</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">Stim.Condition</span><span class="op">+</span><span class="va">Population</span>, <span class="va">vbetaFA</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="op">]</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Done!</span>
<span class="r-in"><span class="co">##log-fold changes in terms of intercept (which is Stim(SEB) and CD154+VbetaResponsive)</span></span>
<span class="r-in"><span class="va">lfcStim</span> <span class="op">&lt;-</span> <span class="fu">logFC</span><span class="op">(</span><span class="va">zz</span><span class="op">)</span></span>
<span class="r-in"><span class="co">##If we want to compare against unstim, we can try the following</span></span>
<span class="r-in"><span class="va">coefnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">zz</span>, <span class="st">'D'</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="va">contrast0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">coefnames</span><span class="op">)</span><span class="op">)</span>, <span class="va">coefnames</span><span class="op">)</span></span>
<span class="r-in"><span class="va">contrast0</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'(Intercept)'</span>, <span class="st">'Stim.ConditionUnstim'</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span class="r-in"><span class="va">contrast1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">coefnames</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">contrast1</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">contrast1</span><span class="op">)</span><span class="op">&lt;-</span><span class="va">coefnames</span></span>
<span class="r-in"><span class="va">contrast1</span><span class="op">[</span><span class="st">'(Intercept)'</span>,<span class="op">]</span><span class="op">&lt;-</span><span class="fl">1</span></span>
<span class="r-in"><span class="va">lfcUnstim</span> <span class="op">&lt;-</span> <span class="fu">logFC</span><span class="op">(</span><span class="va">zz</span>, <span class="va">contrast0</span>, <span class="va">contrast1</span><span class="op">)</span></span>
<span class="r-in"><span class="co">##log-fold change with itself is 0</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">lfcUnstim</span><span class="op">$</span><span class="va">logFC</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="co">##inverse of log-fold change with Stim as reference</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">lfcStim</span><span class="op">$</span><span class="va">logFC</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">==</span><span class="op">(</span><span class="op">-</span><span class="va">lfcUnstim</span><span class="op">$</span><span class="va">logFC</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="co">##As a data.table:</span></span>
<span class="r-in"><span class="fu">getLogFC</span><span class="op">(</span><span class="va">zz</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     primerid                          contrast       logFC  varLogFC</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1:   B3GAT1              Stim.ConditionUnstim -0.05717195 0.6324474</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2:   B3GAT1 PopulationCD154+VbetaUnresponsive -0.28467795 0.4957791</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3:   B3GAT1   PopulationCD154-VbetaResponsive         NaN       NaN</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4:   B3GAT1 PopulationCD154-VbetaUnresponsive -0.73597249 0.2502919</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5:   B3GAT1         PopulationVbetaResponsive -0.73713842 0.2645474</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6:   B3GAT1       PopulationVbetaUnresponsive -0.37754594 0.3765092</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7:      BAX              Stim.ConditionUnstim -0.43275760 1.6497560</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8:      BAX PopulationCD154+VbetaUnresponsive -1.29197981 2.6550423</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9:      BAX   PopulationCD154-VbetaResponsive -0.61352080 2.7503564</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10:      BAX PopulationCD154-VbetaUnresponsive -1.95097043 1.7282713</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11:      BAX         PopulationVbetaResponsive  1.08078307 2.2660863</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12:      BAX       PopulationVbetaUnresponsive  1.33097535 2.3109374</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13:     BCL2              Stim.ConditionUnstim -1.64819989 0.2828739</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14:     BCL2 PopulationCD154+VbetaUnresponsive  0.60475231 1.4007298</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15:     BCL2   PopulationCD154-VbetaResponsive         NaN       NaN</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16:     BCL2 PopulationCD154-VbetaUnresponsive -0.19121849 0.7824061</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17:     BCL2         PopulationVbetaResponsive  1.50241843 1.3773279</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18:     BCL2       PopulationVbetaUnresponsive  1.53341248 1.4119269</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19:     CCL2              Stim.ConditionUnstim  1.19557602 3.4427019</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20:     CCL2 PopulationCD154+VbetaUnresponsive  0.05906539 0.9221676</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21:     CCL2   PopulationCD154-VbetaResponsive -0.55337771 0.6023910</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22:     CCL2 PopulationCD154-VbetaUnresponsive -0.17770906 0.5511114</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23:     CCL2         PopulationVbetaResponsive -1.00620857 0.3483649</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24:     CCL2       PopulationVbetaUnresponsive -1.01896361 0.3446719</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25:     CCL3              Stim.ConditionUnstim -2.63059991 1.8149519</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26:     CCL3 PopulationCD154+VbetaUnresponsive -1.10842024 2.6128681</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27:     CCL3   PopulationCD154-VbetaResponsive -3.09883781 1.5361872</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28:     CCL3 PopulationCD154-VbetaUnresponsive -2.51342528 1.2828719</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 29:     CCL3         PopulationVbetaResponsive -2.64108661 1.5307965</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 30:     CCL3       PopulationVbetaUnresponsive -3.11787999 1.3236893</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     primerid                          contrast       logFC  varLogFC</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               z</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1: -0.07189038</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2: -0.40430559</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3:         NaN</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4: -1.47108647</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5: -1.43316857</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6: -0.61529305</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7: -0.33692625</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8: -0.79290290</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9: -0.36994299</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10: -1.48403698</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11:  0.71796010</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12:  0.87553985</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13: -3.09894170</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14:  0.51097582</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15:         NaN</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16: -0.21617914</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17:  1.28018349</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18:  1.29048477</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19:  0.64435839</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20:  0.06150751</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21: -0.71298836</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22: -0.23938110</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23: -1.70478969</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24: -1.73562443</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25: -1.95264027</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26: -0.68571825</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27: -2.50021164</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28: -2.21908702</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 29: -2.13463639</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 30: -2.70998176</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               z</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Andrew McDavid, Greg Finak, Masanao Yajima.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

